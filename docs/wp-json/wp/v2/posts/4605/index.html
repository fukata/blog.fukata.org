{"id":4605,"date":"2010-07-19T13:21:41","date_gmt":"2010-07-19T04:21:41","guid":{"rendered":"http:\/\/fukata.org\/?p=4605"},"modified":"2017-08-11T22:58:50","modified_gmt":"2017-08-11T22:58:50","slug":"codeigniter-ci_profiler-extends-show-session","status":"publish","type":"post","link":"https:\/\/blog.fukata.org\/archives\/4605\/","title":{"rendered":"[CodeIgniter]CI_Profiler\u3092\u62e1\u5f35\u3057\u3066CI_Session\u5185\u5bb9\u3082\u51fa\u529b\u3057\u3066\u307f\u305f"},"content":{"rendered":"<p>Controller\u306a\u3069\u3067\u4e0b\u8a18\u306e\u3088\u3046\u306b\u8a18\u8ff0\u3059\u308b\u3068\u30c7\u30d0\u30c3\u30b0\u7528\u306b\u5909\u6570\u306e\u5185\u5bb9\u306a\u3069\u3092\u51fa\u529b\u3057\u3066\u304f\u308c\u307e\u3059\u3002<\/p>\n<pre lang=\"PHP\">\r\n$this->output->enable_profiler(true);\r\n<\/pre>\n<p>\u30c7\u30d5\u30a9\u30eb\u30c8\u3060\u3068\u3001\u4e0b\u8a18\u306e\u60c5\u5831\u304c\u8868\u793a\u3055\u308c\u308b\u3088\u3046\u3067\u3059\u3002<\/p>\n<ul>\n<li>URI STRING<\/li>\n<li>CLASS\/METHOD<\/li>\n<li>MEMORY USAGE<\/li>\n<li>BENCHMARKS<\/li>\n<li>GET DATA<\/li>\n<li>POST DATA<\/li>\n<li>QUERIES<\/li>\n<\/ul>\n<p>\u4eca\u56de\u306f\u7701\u7565\u3057\u307e\u3059\u304c\u3001\u30d7\u30ed\u30d5\u30a1\u30a4\u30e9\u7528\u306e\u30db\u30c3\u30af\u306a\u3093\u304b\u3092\u4f7f\u3063\u3066\u304a\u304f\u3068\u4fbf\u5229\u3067\u3059\u3002<\/p>\n<p><strong>\u8ffd\u8a18\uff1a2010-07-20<\/strong><br \/>\n\u5927\u3057\u305f\u30d7\u30ed\u30b0\u30e9\u30e0\u3067\u306f\u306a\u3044\u3067\u3059\u3051\u3069\u3001\u6b8b\u3057\u3066\u304a\u304d\u307e\u3059\u3002<\/p>\n<div id=\"toc_container\" class=\"no_bullets\"><p class=\"toc_title\">\u76ee\u6b21<\/p><ul class=\"toc_list\"><li><a href=\"#systemapplicationhooksXC_ProfilerHookphp\"><span class=\"toc_number toc_depth_1\">1<\/span> system\/application\/hooks\/XC_ProfilerHook.php<\/a><\/li><li><a href=\"#systemapplicationconfigconfigphp\"><span class=\"toc_number toc_depth_1\">2<\/span> system\/application\/config\/config.php<\/a><\/li><li><a href=\"#systemapplicationconfighooksphp\"><span class=\"toc_number toc_depth_1\">3<\/span> system\/application\/config\/hooks.php<\/a><\/li><li><a href=\"#systemapplicationlibrariesXC_Profilerphp\"><span class=\"toc_number toc_depth_1\">4<\/span> system\/application\/libraries\/XC_Profiler.php<\/a><\/li><li><a href=\"#systemapplicationlanguageenglishprofiler_langphp\"><span class=\"toc_number toc_depth_1\">5<\/span> system\/application\/language\/english\/profiler_lang.php<\/a><\/li><\/ul><\/div>\n<h3><span id=\"systemapplicationhooksXC_ProfilerHookphp\">system\/application\/hooks\/XC_ProfilerHook.php<\/span><\/h3>\n<pre lang=\"PHP\">\r\n< ?php\r\n\/**\r\n * \u30d7\u30ed\u30d5\u30a1\u30a4\u30e9\u7528\u30db\u30c3\u30af\r\n * @author Tatsuya Fukata\r\n *\r\n *\/\r\nclass XC_ProfilerHook {\r\n\t\/** CI\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9 *\/\r\n\tprivate $CI;\r\n\t\r\n\t\/**\r\n\t * \u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\r\n\t *\/\r\n\tpublic function __construct(){\r\n\t\t$this->CI =& get_instance();\r\n\t}\r\n\t\r\n\tpublic function enable_profiler() {\r\n\t\t$this->CI->output->enable_profiler($this->CI->config->item('hook_enable_profiler'));\r\n\t}\r\n}\r\n\r\n?>\r\n<\/pre>\n<p>\u3067\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u4e0b\u8a18\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002<\/p>\n<h3><span id=\"systemapplicationconfigconfigphp\">system\/application\/config\/config.php<\/span><\/h3>\n<pre lang=\"PHP\">\r\n\/\/\u30d7\u30ed\u30d5\u30a1\u30a4\u30e9\u30db\u30c3\u30af\u306e\u6709\u52b9\u5316\r\n$config['hook_enable_profiler'] = true;\r\n<\/pre>\n<p>\u3055\u3089\u306b\u3001hooks.php\u306b\u4e0b\u8a18\u3082\u8ffd\u52a0\u3057\u307e\u3059\u3002<\/p>\n<h3><span id=\"systemapplicationconfighooksphp\">system\/application\/config\/hooks.php<\/span><\/h3>\n<pre lang=\"PHP\">\r\n\/\/\u30d7\u30ed\u30d5\u30a1\u30a4\u30e9\u7528\u30db\u30c3\u30af\r\n$hook['post_controller_constructor'][] = array(\r\n\t'class' => 'XC_ProfilerHook',\r\n\t'function' => 'enable_profiler',\r\n\t'filename' => 'XC_ProfilerHook.php',\r\n\t'filepath' => 'hooks',\r\n);\r\n<\/pre>\n<p>\u3053\u308c\u3067\u3001\u30ed\u30fc\u30ab\u30eb\u3084\u3001\u958b\u767a\u74b0\u5883\u3067\u306f\u30d7\u30ed\u30d5\u30a1\u30a4\u30e9\u3092\u6709\u52b9\u306b\u3057\u3066\u304a\u3044\u3066\u3001\u30c6\u30b9\u30c8\u74b0\u5883\u3084\u672c\u756a\u3067\u4e00\u62ec\u3067\u30d7\u30ed\u30d5\u30a1\u30a4\u30e9\u306e\u8a2d\u5b9a\u3092\u5207\u308a\u66ff\u3048\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002<\/p>\n<p>\u3067\u3001\u672c\u984c\u306ePHP\u6a19\u6e96\u306eSession\u6a5f\u69cb\u3092\u4f7f\u7528\u3059\u308bCI_Session\u62e1\u5f35\u306e\u30b3\u30fc\u30c9\u3067\u3059\u3002<\/p>\n<p>\u524d\u56de\u306e\u8a18\u4e8b\u3067CI_Session\u306e\u62e1\u5f35\u306b\u3064\u3044\u3066\u66f8\u3044\u305f\u3064\u3044\u3067\u306bCI_Session\u306e\u6301\u3064\u3001\u30e6\u30fc\u30b6\u30c7\u30fc\u30bf\u306e\u5185\u5bb9\u3082\u51fa\u529b\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u307e\u3057\u305f\u3002<\/p>\n<h3><span id=\"systemapplicationlibrariesXC_Profilerphp\">system\/application\/libraries\/XC_Profiler.php<\/span><\/h3>\n<pre lang=\"PHP\">\r\n< ?php\r\n\/**\r\n * \u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30d7\u30ed\u30d5\u30a1\u30a4\u30e9\u7d50\u679c\u306bCI_Session\u306e\u6301\u3064\u3001\u30e6\u30fc\u30b6\u30c7\u30fc\u30bf\u3092\u8ffd\u52a0\u3059\u308b\r\n * \r\n * @author Tatsuya Fukata\r\n *\r\n *\/\r\nclass XC_Profiler extends CI_Profiler {\r\n\tpublic function __construct() {\r\n\t\tparent::__construct();\r\n\t}\r\n\t\r\n\tpublic function run() {\r\n\t\t$output = \"<div id='codeigniter_profiler' style='clear:both;background-color:#fff;padding:10px;'>\";\r\n\t\t\r\n\t\t\/\/ XXX \u30b9\u30fc\u30d1\u30af\u30e9\u30b9\u306eprivate\u30e1\u30bd\u30c3\u30c9\u306e\u305f\u3081\u3001\u500b\u5225\u5b9a\u7fa9\r\n\t\t$output .= $this->_compile_uri_string();\r\n\t\t$output .= $this->_compile_controller_info();\r\n\t\t$output .= $this->_compile_memory_usage();\r\n\t\t$output .= $this->_compile_benchmarks();\r\n\t\t$output .= $this->_compile_get();\r\n\t\t$output .= $this->_compile_post();\r\n\t\t$output .= $this->_compile_queries();\r\n\t\t\r\n\t\t$output .= $this->_compile_session();\r\n\r\n\t\t$output .= '';\r\n\r\n\t\treturn $output;\r\n\t}\r\n\t\r\n\t\/**\r\n\t * \u30e6\u30fc\u30b6\u30c7\u30fc\u30bf\u60c5\u5831\u3092\u8fd4\u3059\u3002\r\n\t * @return String\r\n\t *\/\r\n\tprotected function _compile_session() {\r\n\t\tif (!isset($this->CI->session) || (!is_a($this->CI->session, 'CI_Session') && !is_subclass_of($this->CI->session, 'CI_Session'))) {\r\n\t\t\treturn '';\r\n\t\t}\r\n\t\t\r\n\t\t$output  = \"\\n\\n\";\r\n\t\t$output .= '<fieldset style=\"border:1px solid #FF3535;padding:6px 10px 10px 10px;margin:20px 0 20px 0;background-color:#eee\">';\r\n\t\t$output .= \"\\n\";\r\n\t\t$output .= '<legend style=\"color:#FF3535;\">&nbsp;&nbsp;'.$this->CI->lang->line('profiler_session').'&nbsp;&nbsp;<\/legend>';\r\n\t\t$output .= \"\\n\";\r\n\t\t$output .= \"\\n\\n<table cellpadding='4' cellspacing='1' border='0' width='100%'>\\n\";\r\n\t\t\r\n\t\t$session = $this->CI->session->all_userdata();\r\n\t\tif (empty($session) || count($session)==0) {\r\n\t\t\t$output .= \"<tr><td width='100%' style='color:#FF3535;font-weight:normal;background-color:#eee;'>\".$this->CI->lang->line('profiler_no_session').\"<\/td><\/tr>\\n\";\r\n\t\t} else {\r\n\t\t\tforeach ($session as $key => $val) {\r\n\t\t\t\t$output .= \"<tr><td width='100%' style='color:#FF3535;font-weight:normal;background-color:#eee;'>\".$key.' => '.print_r($val, true).\"<\/td><\/tr>\\n\";\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t$output .= \"<\/table>\\n\";\r\n\t\t$output .= \"<\/fieldset>\";\r\n\t\t\r\n\t\treturn $output;\r\n\t}\r\n}\r\n?>\r\n<\/pre>\n<p>\u30d7\u30ed\u30d5\u30a1\u30a4\u30e9\u7d50\u679c\u3068\u3057\u3066\u4f7f\u7528\u3059\u308b\u8a00\u8a9e\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002<br \/>\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u3082\u306e\u306f\u3001<strong>system\/language\/english\/profiler_lang.php<\/strong>\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u72ec\u81ea\u3067\u4f5c\u6210\u3057\u305f\u8a00\u8a9e\u30d5\u30a1\u30a4\u30eb\u5185\u3067\u8aad\u307f\u8fbc\u3080\u3088\u3046\u306b\u3057\u307e\u3059\u3002<\/p>\n<h3><span id=\"systemapplicationlanguageenglishprofiler_langphp\">system\/application\/language\/english\/profiler_lang.php<\/span><\/h3>\n<pre lang=\"PHP\">\r\n< ?php\r\n\r\n\/\/ \u65e2\u5b58\u306e\u8a00\u8a9e\u30d5\u30a1\u30a4\u30eb\r\n@include_once(BASEPATH.'language\/english\/profiler_lang.php');\r\n\r\n\/\/ \u4ee5\u4e0b\u3001\u72ec\u81ea\u8ffd\u52a0\u5206\r\n$lang['profiler_session'] = 'SESSION';\r\n$lang['profiler_no_session'] = 'No SESSION data exists';\r\n\r\n\/* End of file profiler_lang.php *\/\r\n\/* Location: .\/system\/language\/english\/profiler_lang.php *\/\r\n?>\r\n<\/pre>\n","protected":false},"excerpt":{"rendered":"<p>Controller\u306a\u3069\u3067\u4e0b\u8a18\u306e\u3088\u3046\u306b\u8a18\u8ff0\u3059\u308b\u3068\u30c7\u30d0\u30c3\u30b0\u7528\u306b\u5909\u6570\u306e\u5185\u5bb9\u306a\u3069\u3092\u51fa\u529b\u3057\u3066\u304f\u308c\u307e\u3059\u3002 $this->output->enable_profiler(true); \u30c7\u30d5\u30a9\u30eb\u30c8\u3060\u3068\u3001\u4e0b\u8a18\u306e\u60c5\u5831\u304c &#8230; <a href=\"https:\/\/blog.fukata.org\/archives\/4605\/\"> \u7d9a\u304d\u3092\u8aad\u3080<\/a><\/p>\n","protected":false},"author":2,"featured_media":9223372036854775807,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":[],"categories":[1980],"tags":[153],"_links":{"self":[{"href":"https:\/\/blog.fukata.org\/wp-json\/wp\/v2\/posts\/4605"}],"collection":[{"href":"https:\/\/blog.fukata.org\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/blog.fukata.org\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/blog.fukata.org\/wp-json\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"https:\/\/blog.fukata.org\/wp-json\/wp\/v2\/comments?post=4605"}],"version-history":[{"count":0,"href":"https:\/\/blog.fukata.org\/wp-json\/wp\/v2\/posts\/4605\/revisions"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/blog.fukata.org\/wp-json\/wp\/v2\/media\/9223372036854775807"}],"wp:attachment":[{"href":"https:\/\/blog.fukata.org\/wp-json\/wp\/v2\/media?parent=4605"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/blog.fukata.org\/wp-json\/wp\/v2\/categories?post=4605"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/blog.fukata.org\/wp-json\/wp\/v2\/tags?post=4605"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}